### Step 2: Creating New Records

In this step, you'll learn how to create new records in your Keeper Vault using the KSM JavaScript SDK. We'll create a login record with a randomly generated password.

### 1. Create New Script file: `create_record.js`

<pre class="file" data-filename="create_record.js" data-target="replace">
const {
    createSecret,
    initializeStorage,
    localConfigStorage,
    generatePassword, // Import generatePassword
    LoginField,       // Import LoginField
    PasswordField     // Import PasswordField
} = require("@keeper-security/secrets-manager-core");

// Replace with your token if myksmconfig.json doesn't exist yet
const ONE_TIME_TOKEN = "[ONE_TIME_TOKEN_IF_NEEDED]"; 
const CONFIG_FILE_NAME = "myksmconfig.json";

// Replace with the UID of the folder where the new record will be stored
// This is typically a Shared Folder UID shared with your KSM application.
const TARGET_FOLDER_UID = "[YOUR_TARGET_FOLDER_UID_HERE]";

async function createNewKeeperRecord() {
    const storage = localConfigStorage(CONFIG_FILE_NAME);
    
    try {
        // Initialize storage if config file doesn't exist or token is explicitly provided
        // For subsequent runs, if myksmconfig.json exists, ONE_TIME_TOKEN can be an empty string or null
        await initializeStorage(storage, ONE_TIME_TOKEN);
        console.log("KSM storage initialized or configuration loaded.");
    } catch (e) {
        // This might happen if token is invalid and config doesn't exist, or already initialized.
        // We assume config exists or token is valid for this step for simplicity.
        console.log("Proceeding with existing configuration or if token was for initialization.");
    }

    const options = { storage: storage };

    try {
        const newPassword = await generatePassword(16, 4, 4, 4, 4); // Generate a 16-char password

        // Construct the record data using SDK field classes
        const recordData = {
            title: "My JS SDK Record - " + Date.now(),
            type: "login", // Standard record type
            fields: [
                new LoginField("sdk_user@example.com"),
                new PasswordField(newPassword)
                // You can add more fields like UrlField, etc.
                // new UrlField("https://example.com") 
            ],
            notes: "This record was created by the KSM JavaScript SDK Katacoda tutorial. \nPassword generated by SDK."
        };

        // Create the secret in the specified folder
        const newRecordUid = await createSecret(options, TARGET_FOLDER_UID, recordData);
        
        console.log(`Record "${recordData.title}" was successfully created!`);
        console.log(`New Record UID: ${newRecordUid}`);
        console.log(`Generated Password: ${newPassword}`);

    } catch (error) {
        console.error("Error creating record:", error.message);
        if (error.cause) {
            console.error("Cause:", error.cause);
        }
    }
}

createNewKeeperRecord().catch(error => {
    console.error("An unexpected error occurred:", error);
});
</pre>

### 2. Configure Placeholders

- In `create_record.js`:
    - Replace `[ONE_TIME_TOKEN_IF_NEEDED]` with your token if `myksmconfig.json` doesn't exist or you want to force re-initialization.
    - Replace `[YOUR_TARGET_FOLDER_UID_HERE]` with the UID of the Keeper Shared Folder where you want to create this new record. This folder must be shared with your KSM application.

### 3. Execute the Script

Run the script to create the new record:

`node create_record.js`{{execute}}

You should see a confirmation message with the new record's UID and the generated password.
Check your Keeper Vault to see the newly created record!
